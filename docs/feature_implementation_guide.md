# 온톨로지 및 LLM 확장 가이드: 새로운 기능 추가 시 작업 흐름

사용자가 질문하신 **"새로운 기능(예: 길찾기)을 추가할 때 온톨로지와 LLM에서 각각 어떤 작업을 해야 하는가?"**에 대한 개념과 절차를 정리한 문서입니다.

이 시스템은 **[뇌(Ontology)]**와 **[입(LLM)]**의 협업으로 돌아갑니다.

---

## 1. 개념 잡기: 온톨로지와 LLM의 역할

| 구분 | 역할 | 비유 | 필요한 작업 |
| :--- | :--- | :--- | :--- |
| **온톨로지 (Ontology)** | **지식 저장소 (Knowledge Base)**<br>데이터와 그 데이터의 구조(Schema)를 담고 있습니다. | **"도서관의 책"**<br>책에 정보가 없으면 아무리 똑똑한 사서도 답을 못 줍니다. | **데이터 추가 (Data Entry)**<br>**스키마 정의 (Schema Def)** |
| **LLM** | **통역사 & 검색기 (Reasoning Engine)**<br>사용자의 말을 알아듣고, 온톨로지 언어(SPARQL)로 바꿔서 정보를 찾아옵니다. | **"똑똑한 사서"**<br>사용자의 의도를 파악해서 알맞은 책을 찾아 내용을 읽어줍니다. | **프롬프트 수정 (Prompt Eng)**<br>**로직 추가 (Code Logic)** |

---

## 2. 작업 흐름 (Workflow): "위치 기반 길찾기" 예시

새로운 기능을 추가하려면 **[온톨로지 작업]**을 먼저 해서 "재료"를 준비하고, **[LLM 작업]**을 통해 "요리법"을 가르쳐야 합니다.

### Step 1. 온톨로지 작업 (데이터 준비)
**"LLM이 꺼내 쓸 수 있는 정보가 그래프에 있는가?"**

1.  **스키마(TBox) 확인/추가**:
    *   위치를 표현할 "그릇"이 필요합니다.
    *   *작업*: `Venue` 클래스에 `geoLat`(위도), `geoLng`(경도)라는 **속성(Property)**이 정의되어 있어야 합니다.
    *   *확인*: 현재 우리 프로젝트에는 이미 정의되어 있습니다. (없다면 `.ttl` 파일에 Property 정의 추가 필요)

2.  **데이터(ABox) 채우기**:
    *   그릇만 있으면 안 되고, 실제 "내용물"이 있어야 합니다.
    *   *작업*: `301동 식당`의 `geoLat`은 `37.449...`이다, 라는 실제 데이터를 `.ttl` 파일에 적어넣어야 합니다.
    *   *상황*: 만약 이 데이터가 비어있다면, LLM이 아무리 쿼리를 잘 짜도 결과는 `Empty`입니다.

### Step 2. LLM 작업 (지능 부여)
**"LLM이 이 정보를 언제, 어떻게 써야 하는지 아는가?"**

1.  **스키마 정보 주입 (Context Update)**:
    *   LLM에게 "이제 우리 데이터베이스에 `geoLat`이랑 `geoLng`도 있어!"라고 알려줘야 합니다.
    *   *작업*: `core_logic.py`의 `generate_sparql` 함수에 들어가는 `schema_info`에 위경도 속성이 포함되도록 합니다. (현재 자동 추출 로직으로 해결됨)

2.  **프롬프트 및 로직 수정 (Intent & Routing)**:
    *   이게 가장 중요합니다. 단순히 정보를 조회하는 게 아니라, **"길찾기"라는 특수한 행동**을 해야 하기 때문입니다.
    *   *작업*:
        *   LLM에게 **"사용자가 '가는 길'을 물어보면 SPARQL로 메뉴를 찾는 게 아니라, 좌표(geoLat/Lng)를 조회해라"**라고 지시 사항(Prompt)을 추가해야 합니다.
        *   조회된 좌표를 가지고 네이버 지도 링크를 만드는 **Python 코드(Application Logic)**를 추가해야 합니다.

---

## 3. 요약 답변

> **Q. 스키마를 추가하고 쿼리에 추가하면 되는 거야?**

*   **네, 맞습니다.**
    1.  **온톨로지 수정**: 저장할 데이터의 항목(스키마: 위경도)을 만들고, 실제 값(37.xxx, 126.xxx)을 채워 넣습니다.
    2.  **LLM/쿼리 수정**: LLM에게 "길을 물어보면 위경도 데이터를 꺼내(SELECT)"라고 시키고, 그 결과를 이용해 지도 앱을 켜는 코드를 짭니다.

> **Q. 둘 중에 어떤 것들이 추가적으로 필요한 거야?**

*   **데이터가 없다면?** → **온톨로지 작업**이 필수 (발로 뛰어서 좌표 수집해서 입력)
*   **데이터는 있는데 멍청하게 답하면?** → **LLM 프롬프트/로직 작업**이 필수 ("좌표 가져와!"라고 쿼리를 못 짜거나, 가져온 좌표로 엉뚱한 소리를 할 때)

**결론적으로 현재 프로젝트 상황에서는:**
1.  **온톨로지**: `abox.ttl`에 빈 지리 정보가 없는지 확인하고 채워 넣는 **데이터 보정 작업**이 필요합니다.
2.  **LLM**: 좌표를 단순 조회하는 것을 넘어, 네이버 지도를 켜주는 **새로운 기능(Python 함수 + 프롬프트)** 구현이 필요합니다.
